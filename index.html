<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="webthemez">
<title>Capstone 2020</title>
<!-- core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/animate.min.css" rel="stylesheet">
<link href="css/owl.carousel.css" rel="stylesheet">
<link href="css/owl.transitions.css" rel="stylesheet">
<link href="css/prettyPhoto.css" rel="stylesheet">  
<link href="css/magnific-popup.css" rel="stylesheet">  
<link href="css/gallery-1.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="js/d3-tip.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
<!--[if lt IE 9]>
<script src="js/html5shiv.js"></script>
<script src="js/respond.min.js"></script>
<![endif]-->       
<link rel="shortcut icon" href="images/ico/logo.png"> 
</head> 

<body id="home">

<header id="header">
	<nav id="main-nav" class="navbar navbar-default navbar-fixed-top" role="banner">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html"><img src="images/cusplogo.png" alt="NYU CUSP logo" id='cusplogo'></a>
			</div>
			
			<div class="collapse navbar-collapse navbar-right">
				<ul class="nav navbar-nav">
					<li class="scroll active"><a href="#home">Home</a></li> 
					<li class="scroll"><a href="#overview">Overview</a></li>
					<li class="scroll"><a href="#data">Data</a></li>
					<li class="scroll"><a href="#method">Method</a></li>
					<li class="scroll"><a href="#testimonial">Result</a></li>
					<li class="scroll"><a href="#conclusion">Conclusion</a></li>
					<li class="scroll"><a href="#team">Team</a></li>                       
				</ul>
			</div>
		</div><!--/.container-->
	</nav><!--/nav-->
</header><!--/header-->

<section id="hero-text" class="wow fadeIn align-center">
		<div class="row">
			<div class="col-sm-12">
				<div class="hometitle content-section">
					<div class="item item-1">
						<div class="image"></div>
						<div class="info">
							  <h1>Socio-Economic Impacts of COVID-19<br>  on NYC Communities</h1>
							  <h3>NYU CUSP Capstone Project 2020</h3>
						</div>
					</div>
				</div>
			</div> 
		</div>
</section><!--/#hero-text-->

<section id="overview">
	<div class="container">

		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Overview</h2>
			<p class="text-center wow fadeInDown">The goal of this project is to leverage real-time urban data to help New York City government and community organizations identify community-level response to the Covid-19 epidemic within a low-income neighborhood disproportionately affected by the disease, using Brownsville, Brooklyn as the study case. </p>
		</div>

		<div class="row">

			<div class="col-sm-12 wow fadeInRight">
				<h3 class="column-title">Introduction</h3>
				<p>COVID-19 is a disease resulting from the SARS-CoV2 virus, which has reached pandemic status globally, according to the World Health Organization. Among cities greatly affected by this disease, New York City is at the forefront. Businesses have been forced to shut down, increasing unemployment rates while decreasing access to essential services for many New Yorkers. Social distancing and stay-at-home policies have been enforced, fundamentally changing the social behaviors of New Yorkers.</p>

				<p>Using publicly available data sources, the team will analyze social and economic impacts of Covid-19 on Brownsville to help city government and organizations identify these issues. Factors including transportation, public sentiment dynamics, and environment will be assessed. In collaboration with the non-profit groups Civ:Lab and Public Sentiment, the project team will provide analyses and visualizations to identify and map the specific needs of Brownsville residents impacted by the Covid-19 crisis. Project deliverables will include a website and report detailing the research findings. An additional memo, summarizing the findings for policymakers, will also be provided.</p>

			</div>
		</div>
	</div>
</section><!--/#about-->

<section id="data" >
	<div class="container">

		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Data</h2>
			<p class="text-center wow fadeInDown">All data our team used for this project were collected from NY Open Data, NYC Department of Health, US Census Bureau, Twitter and NYU CUSP.</p>
		</div>

		<div class="row">
			<div class="features">
				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="0ms">
					<div class="media service-box">
					<div class="hexagon">
					  <div class="inner">              
						  <i class="fa fa-stethoscope"></i>
					  </div>
					</div> 
						<div class="media-body">
							<h4 class="media-heading">Health Data</h4>
							<p>The health data includes the COVID-19 related data, and health facilities data from New York State.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->

				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="100ms">
					<div class="media service-box">
					<div class="hexagon">
					  <div class="inner">              
						<i class="fa fa-phone"></i>
					  </div>
					</div>  
						<div class="media-body">
							<h4 class="media-heading">311 Data</h4>
							<p>The 311 Data included all the requests and complaints of non-emergency municipal services.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->

				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="200ms">
					<div class="media service-box"> 
							<div class="hexagon">
					  <div class="inner">  
							<i class="fa fa-car"></i>
					  </div>
					</div>  
						<div class="media-body">
							<h4 class="media-heading">Transportation Data</h4>
							<p>MTA turnstile data counts entries and exits through the turnstiles for every subway station in New York City.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->
			
				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="300ms">
					<div class="media service-box">
						
							<div class="hexagon">
					  <div class="inner">  
							<i class="fa fa-twitter"></i>
					  </div>
					</div>  
						<div class="media-body">
							<h4 class="media-heading">Twitter Data</h4>
							<p>Twitter data includes the tweets related to COVID-19 across New York City during the pandemic period.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->

				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="400ms">
					<div class="media service-box">
						<div class="hexagon">
					  <div class="inner">  
							<i class="fa fa-university"></i>
					  </div>
					</div>   
						<div class="media-body">
							<h4 class="media-heading">Census Data</h4>
							<p>The census data includes demographic, economic and population data across Brooklyn.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->

				<div class="col-md-4 col-sm-6 wow fadeInUp" data-wow-duration="300ms" data-wow-delay="500ms">
					<div class="media service-box">
						<div class="hexagon">
					  <div class="inner">  
							<i class="fa fa-database"></i>
					  </div>
					</div>    
						<div class="media-body">
							<h4 class="media-heading">Others</h4>
							<p>Grocery stores, air quality, parks and Trees data were all used in this project.</p>
						</div>
					</div>
				</div><!--/.col-md-4-->
			</div>
		</div><!--/.row-->    
	</div><!--/.container-->
</section><!--/#services-->

<section id="method">
	<div class="container">
		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Methodology</h2>
			<p class="text-center wow fadeInDown">Different methods were used in this project: cosine similarity, linear regression, temporal and spatial analysis, and sentiment analysis.</p>
		</div>

		<div class="row">
			<div class="col-md-6 col-sm-12 wow fadeInDown">
				<h4 class="text-center">Cosine Similarity</h4>
				<p>Cosine similarity, the cosine of the angle between two n-dimensional vectors in an n-dimensional space, is used to rank the most and least similar neighborhoods to Brownsville. The results of the cosine similarity inform which community boards will be compared to analyze the disparate impacts of Covid19 on different neighborhoods. </p>
			</div>
			<div class="col-md-6 col-sm-12 wow fadeInDown">
				<h4 class="text-center">OLS Regression</h4>
				<p>Ordinary Least Square (OLS) regression was used to determine the effects of urban factors on percent positive cases, rate of positive cases, and rate of death of Covid19 cases. The OLS regression was performed on three distinct categories of features to allow for better interpretability of features: occupation, transportation methods to work, and environmental, neighborhood factors. OLS regression allows for easily interpretable results and a means of comparison between the different features.	</p>
			</div>	
		</div>
		<div class="row">
			<div class="col-md-6 col-sm-12 wow fadeInDown">
				<h4 class="text-center">Temporal & Spatial Analysis</h4>
				<p>Temporal analysis focused on the period from March 1 to June 30 2020, compared against March 1 to June 30 2019 to see the impacts of Covid-19 on 311 and mobility. Spatial analysis used Geographic Information Systems (GIS) and geopandas to compare and contrast the disparities in environmental conditions and impacts of Covid-19 across Brooklyn neighborhoods. This included the percentage change in 311 service requests per zip code, the lowest level of granularity available.</p>
			</div>
			<div class="col-md-6 col-sm-12 wow fadeInDown">
				<h4 class="text-center">Sentiment Analysis</h4>
				<p>Sentiment Analysis is used to see see how the public sentiment to COVID-19 changes over time. The sentiment threshold (0.3, 0.7) is set up to categorize each Tweet as positive, negative or neutral. A score between 0 and 0.3 indicates overall negative sentiment, between 0.3 and 0.7 indicates overall neutral sentiment, and above 0.7 indicates overall positive sentiment.</p>
			</div>
		</div>

	</div>
</section><!--/#our-team-->

<section id="testimonial">
	<div class="container">
		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Result</h2>
		</div>
		<div class="row">
			<div class="col-sm-12">
				<div id="map">
					<h4 class="text-center">Number of Total Cases</h3>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-1"></div>
			<div class="col-md-10 col-sm-10">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#311">311</a></li>
					<li><a data-toggle="tab" href="#health">Health</a></li>
					<li><a data-toggle="tab" href="#transportation">Transportation</a></li>
					<li><a data-toggle="tab" href="#twitter">Twitter</a></li>
				</ul>
				<div class="tab-content">
					<div id="311" class="tab-pane fade in active">
					<h3>311 Result</h3>
					<p>Between the dates of March 1 and June 30, comparing 2019 to 2020, there was an approximately 7% percent decrease in the number of 311 calls made in the neighborhood of Brownsville, Brooklyn. This is consistent (although to a smaller degree) with the wider trend of a call decrease in the entire borough of Brooklyn (~10%), as well as New York City (~18%). Choropleth maps indicate that Brownsville does not stand out in terms of percent decrease, as there is an overall decrease in 311 calls across Brooklyn.</p>
					<p><img src="images/result/311_1.PNG" alt=""></p>
					<p>Time series analysis indicated that the trend of percent decrease in phone calls. Starting in June, however, the number of calls in 2020 increased quite drastically, correlated with the preponderance of fireworks throughout the city.</p>
					<p><img src="images/result/311_2.PNG" alt=""></p>
					<p>For Brownsville, distinct changes were observed in the complaint types, as well as the department meant to handle said calls. For 2019, the top call types included “Heat-Hot Water”, “Noise-Residential”, “Unsanitary Condition”, and “Plumbing”. For 2020, the number one call type was “Noise - Residential”, accounting for over 25% of calls. Additionally, there was the emergence of two new categories: “Non-Emergency Police Matter” (~15%), and “Illegal Fireworks”(~8%).</p>
					<p><img src="images/result/311_3.PNG" alt=""></p>
					<p>Noise complaints seem fairly self explanatory. The calling of police for non-emergency matters may be correlated with the rise in cases of Covid-19, as residents look to police departments for assistance with sick family members. Additionally, the spike in consumer complaints could potentially be correlated with the rise in “price gouging” among businesses for essential supplies.</p>
					<p>These results also match the findings that the New York City Police Department (NYPD) responded to over 50% of all 311 calls in 2020 for the time period mentioned above. They were followed by the Department of Housing Preservation and Development (25%), and Consumer Affairs (7%).</p>
					<p><img src="images/result/311_4.PNG" alt=""></p>
					</div>
					<div id="health" class="tab-pane fade">
					<h3>Health and Environment Result</h3>
					<p>The geospatial visualizations reveal the disparities between Brooklyn neighborhoods and OLS regressions reveal the impact of different features on Covid19 cases. CD 16, which contains Brownsville, and CD 17, the community district most similar to CD16, have more cases, deaths, and greater percentage of positive tests than CD 6, the community district least similar to CD 16. The factors that are important to understanding these disparities are illustrated in the OLS regression results.</p>
					<p><img src="images/result/health_1.PNG" alt=""></p>
					<p><img src="images/result/health_2.PNG" alt=""></p>
					<p><img src="images/result/health_3.PNG" alt=""></p>
					<p>The transportation regression shows that working at home has a negative impact on all the analyzed features of Covid19 (percent positive, cases, and death rates), making it the most effective commute method to avoid Covid19. The occupation regression shows that service workers are least affected by Covid19, likely due to their status as non-essential workers. Essential workers like maintenance and transportation personnel show a higher chance of testing positive for Covid19. The environmental regression shows that median income of a neighborhood has an inverse relationship to the three features of Covid19 that were analyzed. Park space and density of trees also have inverse relationships to Covid19. Many of the environmental factors can be related to the wealth of the neighborhood, for example, wealthier neighborhoods have more access to parks, green space and medical facilities.</p>
					</div>
					<div id="transportation" class="tab-pane fade">
					<h3>Transportation Result</h3>
					<p>The transportation analysis for Brownsville shows two drastic decreases in ridership; one on the week of March 16, corresponding to public school closures, and the second one the following week, on the week of March 23, corresponding to stay-at-home orders.</p>
					<p><img src="images/result/trans_3.PNG" alt=""></p>
					<p>While the same decreasing trend can be observed in CD17 and CD6, the extent of decrease is different. The percent difference in ridership is quantified by comparing ridership of March to June 2020 against March to June 2019 for the three community boards shown in Table 7. CD16 and CD17, which are majority low-income, people of color communities, have similar COVID-19 cases and decreases in ridership, -51% and -55% respectively. This is in contrast to CD6 which has more affluent, white residents, significantly less COVID-19 cases, and a larger decrease in ridership of -70.5%.</p>
					<p><img src="images/result/trans_5.PNG" alt=""></p>
					<p>The results indicate that residents of low-income neighborhoods, who make up a large majority of essential workers, lack the ability to work at home and must rely on public transportation to get to work. The OLS results show that these occupations and reliance on public transportation put these residents at increased risk to COVID-19.</p>
					</div>
					<div id="twitter" class="tab-pane fade">
					<h3>Twitter Result</h3>
					<p>The trend of weekly number of tweets posted within Brooklyn was shown in Figure 26. Regarding the number of tweets, it shows that before the advent of the pandemic, there are less tweets posted. While entering into the 11th  week, the number of tweets has a huge increase in the next two weeks and then decreases until 22th week. After 22th, the number of tweets increases again while NYC enters into the reopening phase. Figure 27 shows  the correlation between the number of real infected cases and the number of tweets published each day. The observed positive trend for the correlation is confirmed by the coefficient equal to 0.315.</p>
					<p><img src="images/result/twi_1.PNG" alt=""></p>
					<p>Figure 28 summarizes the number of top hashtags for Brooklyn. The hashtags related to search term such as #COVID-19, #COVID-19, #COVID, #Coronavirus and #Corona have been removed as these keywords served for data extractions. These top hashtags revealed some events or situations happening during the pandemic such as stay at home, quarantine, save the world, billionshields (a challenge that uses recycle empty soda bottles into face shields to against COVID-19) etc.</p>
					<p><img src="images/result/twi_2.PNG" alt=""></p>
					<p>Figure 29 shows the 41% tweets are neutral, 27% show negative emotions and 32% shows positive emotions. Combined with the number of tweets, the Figure 30 shows the number of tweet trends by sentiment category during the 1H of 2020.</p>
					<p><img src="images/result/twi_3.PNG" alt=""></p>
					<p>Based on word frequencies for positive tweets and negative tweets separately, word cloud for each of the two categories was drawn in Figure 31 and 32. The positive tweets contain positive words like “new york”, “great”, “thank” while the negative tweets are mainly expressing worries about people’s health, need and the virus trend.</p>
					<p><img src="images/result/twi_4.PNG" alt="" style="width:45%"> <img src="images/result/twi_5.PNG" alt="" style="width:45%"></p>
					<p>Figure 33, 34, 35, 36 represent the tweets analytical Insight of Brownsville. Though the amount of tweets is limited, the overall sentiment in Brownsville tends to be more positive.</p>
					<p><img src="images/result/twi_6.PNG" alt="" style="width:45%"><img src="images/result/twi_7.PNG" alt="" style="width:45%"></p>
					<p><img src="images/result/twi_8.PNG" alt="" style="width:45%"><img src="images/result/twi_9.PNG" alt="" style="width:45%"></p>
					</div>
				</div>
			</div>
		</div>
	</div>
</section><!--/#testimonial-->

<section id="conclusion">
	<div class="container">
		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Conlusion</h2>
			<div class="row">
			<p>The results from this project supports many of the findings reported by the news and scientific community. Low-income communities of color are disproportionately affected by Covid-19, with more overall cases, more deaths, and a higher percentage of positive cases. The effects of Covid-19 are further exacerbated by transportation methods, occupations, and environmental factors like lack of access to green space and parks. Analysis of 311 shows a consistent trend of less use of government services, with residents shifting concern to noise and Covid-19 related issues.</p>
			<p>Further research would entail studying 311 calls by time of day, and studying the content of each call for sentiment analysis and comparing it with Twitter data. For future Twitter data extraction improvements, the study can be focused on  building a config based pipeline: a) crawl Twitter data by location/search-term two dimensions, b) after data collection, enable auto trigger the model evaluation and result forward. Furthermore, explore the possibility to construct the feedback loop based on the model evaluation results, which can drive crawlers to get more substantial data. Other avenues for future analysis can include economic data like regarding unemployment and small businesses. </p>
			<p>Actions can be taken by individuals and the city to become more resilient to the effects of Covid-19. Individuals can follow CDC guidelines to wear masks and maintain social distancing. Employers should allow employees to work remotely and allow flexible work hours or staggered work schedules, only requiring employees to work in the office if necessary. The city can create more open, green space by expanding parks, opening streets for pedestrians, and planting more trees. Parks and sidewalks can be used as outdoor work spaces. The city can create a platform that allows citizens to voice their needs in real-time, allowing government agencies to plan and allocate resources for communities with reduced delays.</p>
			</div>
		</div>
		<div class="row">
			<div class="col-md-1"></div>
			<div class="col-md-10">
				<h4>To know more infroamtion, please refer to our:</h4>
				<p>Github: <a href="https://github.com/ImpactsOfCOVID19InNYCCommunity/NYU-CUSP-Capstone-2020">Impacts of COVID 19 in NYC Community</a></p>
				<p>Paper: </p>
			</div>
		</div>
	</div>
</section>


<section id="team">
	<div class="container">
		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Team</h2>
			<p class="text-center wow fadeInDown">Our Amazimg team</p>
			<div class="row">
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/sponsor.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Simon Sylvester-Chaudhuri</h4> <i class="fa fa-github fa-2x"></i>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/sponsor2.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Michael Lenihan</h4> <i class="fa fa-github fa-2x"></i>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/prof.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Stanislav Sobolevsky</h4> <i class="fa fa-github fa-2x"></i>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/earl.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Earl Lin</h4> <a href="https://github.com/tetrisisfun"><i class="fa fa-github fa-2x"></i></a>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/jerome.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Jerome Louison</h4> <a href="https://github.com/jlouison92"><i class="fa fa-github fa-2x"></i></a>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/yushu.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Yushu Rao</h4> <a href="https://github.com/Natalie-Rao"><i class="fa fa-github fa-2x"></i></a>
				</div>
				<div class="col-md-3 col-sm6 text-center">
					<img src="images/team/xinran.jpg" alt="" class="img-circle" height="200" width="200">
					<h4>Xinran Zhao</h4> <a href="https://github.com/xinran46"><i class="fa fa-github fa-2x"></i></a>
				</div>
			</div>
		</div>
		<div class="section-header">
			<h2 class="section-title text-center wow fadeInDown">Sponsors</h2>
			<div class="row">
				<div class="col-md-3"></div>
				<div class="col-md-3 col-sm-6">
					<a href="http://civ-lab.org/"><img src="images/team/grid.png" alt="" width="250" height="200"></a>
				</div>
				<div class="col-md-3 col-sm-6">
					<a href="https://www.publicsentiment.org/"><img src="images/team/ps.png" alt="" width="180" height="170"></a>
				</div>
			</div>
		</div>
	</div>
</section><!--/#contact-us-->


<footer id="footer">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">Copyright &copy; 2020.Company name All rights reserved.</div>
		</div>
	</div>
</footer><!--/#footer-->

<script src="js/jquery.js"></script>
<!-- <script src="js/bootstrap.min.js"></script> -->
<!---<script src="http://maps.google.com/maps/api/js?sensor=true"></script>--->
<script src="js/owl.carousel.min.js"></script>
<script src="js/mousescroll.js"></script>
<script src="js/smoothscroll.js"></script>
<script src="js/jquery.prettyPhoto.js"></script> 
<script src="js/jquery.inview.min.js"></script>
<script src="js/wow.min.js"></script>
<script src="contact/jqBootstrapValidation.js"></script>
<script src="contact/contact_me.js"></script>
<script type="text/javascript" src="js/jquery.isotope.min.js"></script><!-- Gallery Filter -->
<!-- <script type="text/javascript" src="js/jquery.magnific-popup.min.js"></script><!--Gallery Popup -->
<script src="js/custom-scripts.js"></script>

<script>
      

	d3.csv("https://raw.githubusercontent.com/nychealth/coronavirus-data/master/data-by-modzcta.csv").then(function (csv) {
		console.log(csv);
		var max = d3.max(csv.map(o => Number(o.COVID_CASE_COUNT)));
		var values = [0, 0.2058 * max, 0.4116 * max, 0.588 * max, 0.7938 * max];
		var color = d3.scaleThreshold()
			.domain(values)
			.range(d3.schemePurples[5]);

		var margin = { top: 30, right: 30, bottom: 70, left: 60 },
			width = 900 - margin.left - margin.right,
			height = 600 - margin.top - margin.bottom;

		var svg = d3.select("#map")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		//画图例
		svg.selectAll("rect")
			.data([0, 1, 2, 3])
			.enter()
			.append("rect")
			.attr("transform", function (d, i) { return "translate(" + (i * 55 + 150) + ",50)"; })
			.attr("width", 55)
			.attr("height", 8)
			.style("fill", function (d, i) { return d3.schemePurples[5][i + 1] });

		svg.selectAll("line")
			.data([0, 1, 2, 3, 4])
			.enter()
			.append("line")
			.attr("stroke", "#000")
			.attr("transform", function (d, i) { return "translate(" + (i * 55 + 150) + ",50)"; })
			.attr("y2", "13")
			.attr("x1", "0.5")
			.attr("x2", "0.5")

		svg.selectAll("text")
			.data([0, 1, 2, 3, 4])
			.enter()
			.append("text")
			.attr("transform", function (d, i) { return "translate(" + (i * 50 + 150) + ",80)"; })
			.style("font-size", "11px")
			.text(function (d, i) { return (values[i] / 1000).toFixed(2) + "k" })

		var tooltip = d3.tip()
			.attr("class", "tooltip")
			.style("border-radius", "5px")
			.style("padding", "10px")
			.style("color", "black")
			.html(function (d, i) {
				var thisData = csv.filter(o => o["MODIFIED_ZCTA"] == d.properties.zipcode);
				if (thisData.length==0) {
					return "This zipcode has no data";
				} else {
					return "Zipcode:       " + thisData[0]["MODIFIED_ZCTA"] + "<br>"
					+ "Total Cases:   " + thisData[0]["COVID_CASE_COUNT"]+"<br>"
					+ "Total Tests:   " + thisData[0]["TOTAL_COVID_TESTS"] + "<br>"
					+ "Positive Rate: " + thisData[0]["PERCENT_POSITIVE"] + "<br>"
					+ "Death:         " + thisData[0]["COVID_DEATH_COUNT"] + "<br>" 
					+ "Population:    " + thisData[0]["POP_DENOMINATOR"] ;
				}
			});

		svg.call(tooltip);


		d3.json("https://raw.githubusercontent.com/xinran46/test/master/nyc_zip.geojson.json").then(function (geoJSON) {
			console.log(geoJSON);
			var proj = d3.geoMercator()
				.fitSize([width, height], geoJSON);
			var path = d3.geoPath()
				.projection(proj);

			var states = svg.append("g")
				.attr("transform", function (d, i) { return "translate(" + 100 + ",30)"; })
				.selectAll("path").data(geoJSON.features);

			states.enter().append("path")
				.attr("d", function (d) { return path(d); })
				.attr("fill", function (d) {
					var thisData = csv.filter(o => o["MODIFIED_ZCTA"] == d.properties.zipcode);
					//console.log(thisData);
					if (thisData.length == 0) {
						return "white";
					} else {
						return color(thisData[0]["COVID_CASE_COUNT"]);
					}
				})
				.attr("stroke", function (d) {
					return "#000";
				})
				.on("mouseover", tooltip.show)
				.on("mouseout", tooltip.hide);
		});
	});
</script>

</body>
</html>